# Makefile generated by Smake.

SRCS = src/add.c src/main.c
OBJS = obj/add.c.o obj/main.c.o
DEPS = dep/add.c.d dep/main.c.d
HDRS = include/add.h

# Defaults
PKGS =
TARGET = main
VERSION = unknown
WARNINGS = -Wall -Wextra -Wno-unused-parameter
FLAGS = -Iinclude -fPIC
PROJTYPE = exe

-include Smakefile

CFLAGS += $(FLAGS) $(WARNINGS)
CXXFLAGS += $(FLAGS) $(WARNINGS)
LDFLAGS ?=

PKG_CONFIG ?= pkg-config
AR ?= ar

DESTDIR ?=
PREFIX ?= /usr/local

ifeq ($(filter $(PROJTYPE),exe alib solib),)
$(error Expected PROJTYPE to be exe, alib, or solib)
endif

ifneq ($(PKGS),)
CFLAGS += $(shell $(PKG_CONFIG) --cflags $(PKGS))
CXXFLAGS += $(shell $(PKG_CONFIG) --cflags $(PKGS))
LDFLAGS += $(shell $(PKG_CONFIG) --libs $(PKGS))
endif

# Build executable
ifeq ($(PROJTYPE),exe)
$(TARGET): $(OBJS)
	$(CC) -o $@ $^ $(LDFLAGS)
endif

# Build shared library
ifeq ($(PROJTYE),solib)
$(TARGET): $(OBJS)
	$(CC) -o $@ $^ -shared $(LDLAGS)
endif

# Build static library
ifeq ($(PROJTYPE),alib)
$(TARGET): $(OBJS)
	$(AR) crs $@ $(OBJ)
endif

obj/%.c.o: src/%.c
	@mkdir -p $(@D)
	$(CC) -o $@ -c $< $(CFLAGS)
obj/%.cc.o: src/%.cc
	@mkdir -p $(@D)
	$(CXX) -o $@ -c $< $(CXXFLAGS)

dep/%.c.d: src/%.c $(HDRS)
	@mkdir -p $(@D)
	$(CC) -o $@ -MM $< -MT $(patsubst src/%,obj/%.o,$<) $(CFLAGS)
dep/%.cc.d: src/%.cc $(HDRS)
	@mkdir -p $(@D)
	$(CXX) -o $@ -MM $< -MT $(patsubst src/%,obj/%.o,$<) $(CXXFLAGS)

.PHONY: clean
clean:
	rm -f $(TARGET)
	rm -rf obj dep


# install exe
ifeq ($(PROJTYPE),exe)
.PHONY: install
install: $(TARGET)
	mkdir -p $(DESTDIR)$(PREFIX)/bin
	cp -f $(TARGET) $(DESTDIR)$(PREFIX)/bin
	chmod 755 $(DESTDIR)$(PREFIX)/bin/$(TARGET)

.PHONY: uninstall
uninstall:
	rm -f $(DESTDIR)$(PREFIX)/bin/$(TARGET)
endif

-include $(DEPS)
